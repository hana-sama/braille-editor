(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();/**
 * BRAILLE DATA MODULE
 * ===================
 * All Braille lookup tables, layout configurations, and constants.
 *
 * This module is designed to be:
 * - Audit-friendly: All mappings visible in one place
 * - Test-friendly: Pure data, no side effects
 * - Swap-friendly: Easy to add Grade 2, Japanese Braille, etc.
 *
 * @author Hana
 * @license MIT
 */const ee=10240,te={NUMBER:{codes:[60],display:"â ¼",type:"number",action:"start"},LETTER:{codes:[16],display:"â ",type:"number",action:"end"},CAPITAL_LETTER:{codes:[32],display:"â  ",type:"capital",action:"symbol"},CAPITAL_WORD:{codes:[32,32],display:"â  â  ",type:"capital",action:"word"},CAPITAL_PASSAGE:{codes:[32,32,32],display:"â  â  â  ",type:"capital",action:"passage"},CAPITAL_TERMINATOR:{codes:[32,4],display:"â  â „",type:"capital",action:"end"},ITALIC_SYMBOL:{codes:[40,6],display:"â ¨â †",type:"italic",action:"symbol"},ITALIC_WORD:{codes:[40,1],display:"â ¨â ",type:"italic",action:"word"},ITALIC_PASSAGE:{codes:[40,54],display:"â ¨â ¶",type:"italic",action:"passage"},ITALIC_TERMINATOR:{codes:[40,4],display:"â ¨â „",type:"italic",action:"end"},BOLD_SYMBOL:{codes:[24,6],display:"â ˜â †",type:"bold",action:"symbol"},BOLD_WORD:{codes:[24,1],display:"â ˜â ",type:"bold",action:"word"},BOLD_PASSAGE:{codes:[24,54],display:"â ˜â ¶",type:"bold",action:"passage"},BOLD_TERMINATOR:{codes:[24,4],display:"â ˜â „",type:"bold",action:"end"},UNDERLINE_SYMBOL:{codes:[56,6],display:"â ¸â †",type:"underline",action:"symbol"},UNDERLINE_WORD:{codes:[56,1],display:"â ¸â ",type:"underline",action:"word"},UNDERLINE_PASSAGE:{codes:[56,54],display:"â ¸â ¶",type:"underline",action:"passage"},UNDERLINE_TERMINATOR:{codes:[56,4],display:"â ¸â „",type:"underline",action:"end"},SCRIPT_SYMBOL:{codes:[8,6],display:"â ˆâ †",type:"script",action:"symbol"},SCRIPT_WORD:{codes:[8,1],display:"â ˆâ ",type:"script",action:"word"},SCRIPT_PASSAGE:{codes:[8,54],display:"â ˆâ ¶",type:"script",action:"passage"},SCRIPT_TERMINATOR:{codes:[8,4],display:"â ˆâ „",type:"script",action:"end"}},ie=new Set;(function(){for(const[e,t]of Object.entries(te))t.codes.length>=2&&(ie.add(t.codes[0]),t.codes[0]+""+t.codes[1])})();const oe={1:"a",3:"b",9:"c",25:"d",17:"e",11:"f",27:"g",19:"h",10:"i",26:"j",5:"k",7:"l",13:"m",29:"n",21:"o",15:"p",31:"q",23:"r",14:"s",30:"t",37:"u",39:"v",58:"w",45:"x",61:"y",53:"z",2:",",6:";",18:":",50:".",22:"!",38:"?",4:"'",36:"-",46:"/",52:'"',28:")",60:"â ¼",32:"â  ",16:"â "},ne={1:"1",3:"2",9:"3",25:"4",17:"5",11:"6",27:"7",19:"8",10:"9",26:"0"};Object.entries(oe).forEach(([n,e])=>{e.length===1&&"â  â ¼â ".includes(e)});Object.entries(ne).forEach(([n,e])=>{});const f={perkins:{name:"Perkins Style",description:"Standard QWERTY layout: F/D/S (left) and J/K/L (right)",leftHand:[{key:"f",dot:1},{key:"d",dot:2},{key:"s",dot:3}],rightHand:[{key:"j",dot:4},{key:"k",dot:5},{key:"l",dot:6}]},sixkey:{name:"Six Key",description:"BrailleMemo/Annie style: D/W/Q (left) and K/O/P (right)",leftHand:[{key:"d",dot:1},{key:"w",dot:2},{key:"q",dot:3}],rightHand:[{key:"k",dot:4},{key:"o",dot:5},{key:"p",dot:6}]},homekeys:{name:"Home Keys",description:"ASDF (left) and JKL; (right) - ergonomic position",leftHand:[{key:"a",dot:1},{key:"s",dot:2},{key:"d",dot:3}],rightHand:[{key:"j",dot:4},{key:"k",dot:5},{key:"l",dot:6}]},vimstyle:{name:"Vim Style",description:"F/D/S (left) and H/J/K (right) - familiar navigation keys",leftHand:[{key:"f",dot:1},{key:"d",dot:2},{key:"s",dot:3}],rightHand:[{key:"h",dot:4},{key:"j",dot:5},{key:"k",dot:6}]}},g="perkins",A={LAYOUT:"brailleEditorLayout"};/**
 * EDITOR STATE
 * ============
 * Mode-agnostic editor state management.
 *
 * This class manages the editor's state while delegating
 * mode-specific logic to the current BrailleMode instance.
 *
 * @author Hana
 * @license MIT
 */class re{constructor(e){this.activeDots=new Set,this.brailleContent="",this.textContent="",this.pendingIndicator=null,this.setMode(e)}setMode(e){this.mode=e,this.activeDots=new Set,this.brailleContent="",this.textContent="",this.modeState=e?e.createInitialState():{},this.pendingIndicator=null,this.sequenceState=e?e.createInitialSequenceState():{pendingCodes:[],isActive:!1,depth:0}}resetDots(){this.activeDots.clear()}addDot(e){this.activeDots.add(e)}removeDot(e){this.activeDots.delete(e)}hasDot(e){return this.activeDots.has(e)}getDotsArray(){return Array.from(this.activeDots).sort((e,t)=>e-t)}getCurrentCode(){return this.mode.dotsToCode(this.activeDots)}getCurrentBraille(){return this.mode.codeToBraille(this.getCurrentCode())}clearAll(){this.activeDots.clear(),this.brailleContent="",this.textContent="",this.modeState=this.mode.createInitialState(),this.pendingIndicator=null,this.sequenceState=this.mode.createInitialSequenceState()}deleteLastChar(){this.brailleContent.length!==0&&(this.brailleContent=this.brailleContent.slice(0,-1),this.textContent=this.textContent.slice(0,-1),this._recalculateState())}addNewline(){this.brailleContent+=`
`,this.textContent+=`
`,this.modeState=this.mode.updateState(this.modeState,0," ")}confirmChar(){const e=this.getCurrentCode(),t=this.mode.codeToBraille(e);let i="",o=null;const r={precedingText:this.textContent,precedingBraille:this.brailleContent,state:this.modeState};if(this.sequenceState.isActive){this.sequenceState.pendingCodes.push(e),this.sequenceState.depth++;const s=this.mode.resolveMultiCellSequence(this.sequenceState.pendingCodes,r);if(s){o=s,i=s.text;const p=this.sequenceState.pendingCodes.map(h=>this.mode.codeToBraille(h)).join("");return this.brailleContent+=p,this.textContent+=i,this.modeState=this.mode.applyIndicator(this.modeState,s.name),this._resetSequenceState(),this.resetDots(),{braille:t,text:i,indicator:o}}const c=this.mode.getMaxSequenceDepth();return!this.mode.isPartialSequenceValid(this.sequenceState.pendingCodes)||this.sequenceState.depth>=c?(this._flushPendingCodes(),this._processSingleCode(e),this.resetDots(),{braille:t,text:this.textContent.slice(-1),indicator:null}):(this.resetDots(),{braille:t,text:"",indicator:null,pending:!0})}if(this.mode.canStartSequence(e))return this.sequenceState.isActive=!0,this.sequenceState.pendingCodes=[e],this.sequenceState.depth=1,this.resetDots(),{braille:t,text:"",indicator:null,pending:!0};if(this.pendingIndicator!==null){const s=this.mode.resolveSequence(this.pendingIndicator,e,r);if(s)return o=s,i=s.text,this.brailleContent+=this.mode.codeToBraille(this.pendingIndicator)+t,this.textContent+=i,this.modeState=this.mode.applyIndicator(this.modeState,s.name),this.pendingIndicator=null,this.resetDots(),{braille:t,text:i,indicator:o};this._processSingleCode(this.pendingIndicator),this.pendingIndicator=null}return this.mode.getPrefixCodes&&this.mode.getPrefixCodes().has(e)?(this.pendingIndicator=e,this.resetDots(),{braille:t,text:"",indicator:null,pending:!0}):(this._processSingleCode(e),this.resetDots(),{braille:t,text:this.textContent.slice(-1),indicator:null})}_resetSequenceState(){this.sequenceState={pendingCodes:[],isActive:!1,depth:0}}_flushPendingCodes(){for(const e of this.sequenceState.pendingCodes)this._processSingleCode(e);this._resetSequenceState()}_processSingleCode(e){const t=this.mode.codeToBraille(e),i={precedingText:this.textContent,precedingBraille:this.brailleContent,state:this.modeState};let o=this.mode.codeToText(e,i);e===0&&(o=" "),this.brailleContent+=t,this.textContent+=o,this.modeState=this.mode.updateState(this.modeState,e,o)}_recalculateState(){this.modeState=this.mode.createInitialState(),this.mode.recalculateNumberMode&&(this.modeState.numberMode=this.mode.recalculateNumberMode(this.brailleContent))}getContext(){return{precedingText:this.textContent,precedingBraille:this.brailleContent,state:this.modeState}}isInNumberMode(){return this.modeState.numberMode??!1}getCapitalMode(){return this.modeState.capitalMode??0}cycleCapitalMode(){this.modeState.capitalMode!==void 0&&(this.modeState.capitalMode=(this.modeState.capitalMode+1)%3)}getTypeformMode(){return this.modeState.typeformMode&&this.modeState.typeformScope?{mode:this.modeState.typeformMode,scope:this.modeState.typeformScope}:null}isPendingIndicator(){return this.pendingIndicator!==null||this.sequenceState.isActive}getPendingIndicator(){return this.sequenceState.isActive&&this.sequenceState.pendingCodes.length>0?this.sequenceState.pendingCodes[0]:this.pendingIndicator}getPendingCodes(){return this.sequenceState.isActive?[...this.sequenceState.pendingCodes]:[]}getSequenceDepth(){return this.sequenceState.depth}cancelPendingIndicator(){this.pendingIndicator=null,this._resetSequenceState()}get length(){return this.brailleContent.length}get textLength(){return this.textContent.length}isEmpty(){return this.brailleContent.length===0}hasActiveDots(){return this.activeDots.size>0}}/**
 * MODE REGISTRY
 * =============
 * Central registry for managing braille modes.
 *
 * Features:
 * - Register new braille modes
 * - Switch between modes
 * - Persist mode preference
 * - Notify listeners on mode change
 * - Organize modes by category
 * - Handle mode transitions
 *
 * @author Hana
 * @license MIT
 */class se{constructor(){this.modes=new Map,this.categories=new Map,this.transitions=new Map,this.currentMode=null,this.listeners=new Set,this.storageKey="brailleEditorMode"}register(e){if(!(e!=null&&e.id)||!e.name)throw new Error("Invalid mode: must have id and name");if(this.modes.has(e.id))throw new Error(`Mode already registered: ${e.id}`);this.modes.set(e.id,e),console.log(`[ModeRegistry] Registered mode: ${e.name} (${e.id})`)}unregister(e){var t;((t=this.currentMode)==null?void 0:t.id)===e&&(this.currentMode=null),this.modes.delete(e)}setMode(e){if(!this.modes.has(e))throw new Error(`Unknown mode: ${e}`);const t=this.currentMode;this.currentMode=this.modes.get(e),this.savePreference(e),this.notifyListeners({type:"modeChange",previousMode:(t==null?void 0:t.getInfo())??null,currentMode:this.currentMode.getInfo()}),console.log(`[ModeRegistry] Switched to mode: ${this.currentMode.name}`)}getMode(){return this.currentMode}getModeById(e){return this.modes.get(e)}getAllModes(){return Array.from(this.modes.values())}getModeOptions(){return this.getAllModes().map(e=>e.getInfo())}cycleToNext(){const e=Array.from(this.modes.keys());if(e.length===0)throw new Error("No modes registered");const i=((this.currentMode?e.indexOf(this.currentMode.id):-1)+1)%e.length;return this.setMode(e[i]),this.currentMode}cycleToPrevious(){const e=Array.from(this.modes.keys());if(e.length===0)throw new Error("No modes registered");const i=((this.currentMode?e.indexOf(this.currentMode.id):-1)-1+e.length)%e.length;return this.setMode(e[i]),this.currentMode}savePreference(e){try{localStorage.setItem(this.storageKey,e)}catch(t){console.warn("[ModeRegistry] Failed to save mode preference:",t)}}loadPreference(e){try{const t=localStorage.getItem(this.storageKey);if(t&&this.modes.has(t))return t}catch(t){console.warn("[ModeRegistry] Failed to load mode preference:",t)}return e}clearPreference(){try{localStorage.removeItem(this.storageKey)}catch(e){console.warn("[ModeRegistry] Failed to clear mode preference:",e)}}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch(i){console.error("[ModeRegistry] Listener error:",i)}})}hasMode(e){return this.modes.has(e)}get modeCount(){return this.modes.size}isModeActive(e){var t;return((t=this.currentMode)==null?void 0:t.id)===e}registerCategory(e){if(this.categories.has(e.id)){console.warn(`[ModeRegistry] Category already exists: ${e.id}`);return}this.categories.set(e.id,{...e,modes:[]}),console.log(`[ModeRegistry] Registered category: ${e.name} (${e.id})`)}registerModeWithCategory(e,t){this.register(e);const i=this.categories.get(t);i?(i.modes.push(e.getInfo()),console.log(`[ModeRegistry] Added mode ${e.name} to category ${i.name}`)):console.warn(`[ModeRegistry] Category not found: ${t}, mode registered without category`)}getCategory(e){return this.categories.get(e)}getAllCategories(){return Array.from(this.categories.values())}getModesByCategory(e){const t=this.categories.get(e);return(t==null?void 0:t.modes)??[]}getCurrentCategory(){if(!this.currentMode)return null;for(const e of this.categories.values())if(e.modes.some(t=>{var i;return t.id===((i=this.currentMode)==null?void 0:i.id)}))return e;return null}registerTransition(e){const t=`${e.from}:${e.to}`;this.transitions.set(t,e)}getTransition(e,t){return this.transitions.get(`${e}:${t}`)}setModeWithTransition(e){const t=this.currentMode,i=t?this.getTransition(t.id,e):null;this.setMode(e),i&&console.log(`[ModeRegistry] Applied transition: ${i.from} -> ${i.to}`)}}const d=new se;/**
 * BRAILLE MODE BASE CLASS
 * =======================
 * Abstract base class for all braille modes (UEB Grade 1, UEB Grade 2, Japanese Kana, etc.)
 *
 * Each mode must implement the required methods to provide:
 * - Character mapping (braille code â†” text)
 * - Indicator handling
 * - State management
 * - Context-dependent resolution
 *
 * @author Hana
 * @license MIT
 */class ae{constructor(e){this.BRAILLE_START=10240,this.name=e.name,this.id=e.id,this.description=e.description,this.language=e.language??"en"}getIndicators(){return{}}textToCode(e){const t=this.getAlphabet();for(const[i,o]of Object.entries(t))if(o===e)return parseInt(i)}getNumberMap(){return{}}getPrefixCodes(){return new Set}resolveSequence(e,t,i){return null}getSequenceResolvers(){return[]}getMaxSequenceDepth(){return 3}canStartSequence(e){return this.getSequenceResolvers().some(i=>i.prefixCodes.has(e))}resolveMultiCellSequence(e,t){if(e.length===0)return null;const i=this.getSequenceResolvers();for(const o of i){if(e.length<o.minCells||e.length>o.maxCells||!o.prefixCodes.has(e[0]))continue;const r=o.resolve(e,t);if(r)return r}return null}isPartialSequenceValid(e){if(e.length===0)return!1;const t=this.getSequenceResolvers(),i=this.getMaxSequenceDepth();if(e.length>=i)return!1;for(const o of t)if(e.length<o.maxCells&&o.prefixCodes.has(e[0]))return!0;return!1}createInitialSequenceState(){return{pendingCodes:[],isActive:!1,depth:0}}requiresContext(){return!1}getContextDependent(){return{}}createInitialState(){return{numberMode:!1,capitalMode:0,pendingIndicator:null,typeformMode:null,typeformScope:null}}updateState(e,t,i){return{...e}}resetState(e){return this.createInitialState()}applyIndicator(e,t){return{...e}}codeToBraille(e){return String.fromCharCode(this.BRAILLE_START+e)}brailleToCode(e){return e.charCodeAt(0)-this.BRAILLE_START}dotsToCode(e){let t=0;for(const i of e)t|=1<<i-1;return t}codeToDots(e){const t=[];for(let i=1;i<=6;i++)e&1<<i-1&&t.push(i);return t}toString(){return this.name}getInfo(){return{name:this.name,id:this.id,description:this.description,language:this.language}}isLetterAtoJ(e){return!1}isLetter(e){return!1}recalculateNumberMode(e){return!1}}/**
 * UEB GRADE 1 MODE
 * ================
 * Unified English Braille Grade 1 (uncontracted) mode implementation.
 *
 * Features:
 * - Full alphabet mapping
 * - Number mode with number sign
 * - Capitalization indicators
 * - Punctuation and symbols
 * - Typeform indicators (italic, bold, underline, script)
 *
 * @author Hana
 * @license MIT
 */class K extends ae{constructor(){super({name:"UEB Grade 1",id:"ueb1",description:"Unified English Braille Grade 1 (uncontracted)",language:"en"}),this.alphabet={},this.numberMap={},this.symbols={},this.contextDependent={},this.indicators={},this.prefixCodes=new Set,this.sequenceMap={},this.sequenceResolvers=[],this.indicatorCodes={NUMBER_SIGN:60,CAPITAL_SIGN:32,CONTINUOUS_CAPS:48,LETTER_SIGN:16},this._initData()}_initData(){this.alphabet={1:"a",3:"b",9:"c",25:"d",17:"e",11:"f",27:"g",19:"h",10:"i",26:"j",5:"k",7:"l",13:"m",29:"n",21:"o",15:"p",31:"q",23:"r",14:"s",30:"t",37:"u",39:"v",58:"w",45:"x",61:"y",53:"z"},this.numberMap={1:"1",3:"2",9:"3",25:"4",17:"5",11:"6",27:"7",19:"8",10:"9",26:"0"},this.symbols={2:",",6:";",18:":",50:".",22:"!",38:"?",4:"'",36:"-",46:"/",40:'"',28:")"},this.contextDependent={38:{default:"?",variants:{opening_quote:'"'},rule:"space_or_start_before"}},this.indicators={CAPITAL_LETTER:{codes:[32],display:"â  ",type:"capital",action:"symbol"},CAPITAL_WORD:{codes:[32,32],display:"â  â  ",type:"capital",action:"word"},CAPITAL_PASSAGE:{codes:[32,32,32],display:"â  â  â  ",type:"capital",action:"passage"},CAPITAL_TERMINATOR:{codes:[32,4],display:"â  â „",type:"capital",action:"end"},ITALIC_SYMBOL:{codes:[40,6],display:"â ¨â †",type:"italic",action:"symbol"},ITALIC_WORD:{codes:[40,1],display:"â ¨â ",type:"italic",action:"word"},ITALIC_PASSAGE:{codes:[40,54],display:"â ¨â ¶",type:"italic",action:"passage"},ITALIC_TERMINATOR:{codes:[40,4],display:"â ¨â „",type:"italic",action:"end"},BOLD_SYMBOL:{codes:[24,6],display:"â ˜â †",type:"bold",action:"symbol"},BOLD_WORD:{codes:[24,1],display:"â ˜â ",type:"bold",action:"word"},BOLD_PASSAGE:{codes:[24,54],display:"â ˜â ¶",type:"bold",action:"passage"},BOLD_TERMINATOR:{codes:[24,4],display:"â ˜â „",type:"bold",action:"end"},UNDERLINE_SYMBOL:{codes:[56,6],display:"â ¸â †",type:"underline",action:"symbol"},UNDERLINE_WORD:{codes:[56,1],display:"â ¸â ",type:"underline",action:"word"},UNDERLINE_PASSAGE:{codes:[56,54],display:"â ¸â ¶",type:"underline",action:"passage"},UNDERLINE_TERMINATOR:{codes:[56,4],display:"â ¸â „",type:"underline",action:"end"},SCRIPT_SYMBOL:{codes:[8,6],display:"â ˆâ †",type:"script",action:"symbol"},SCRIPT_WORD:{codes:[8,1],display:"â ˆâ ",type:"script",action:"word"},SCRIPT_PASSAGE:{codes:[8,54],display:"â ˆâ ¶",type:"script",action:"passage"},SCRIPT_TERMINATOR:{codes:[8,4],display:"â ˆâ „",type:"script",action:"end"}},this._buildPrefixLookup()}_buildPrefixLookup(){this.prefixCodes=new Set,this.sequenceMap={};for(const[e,t]of Object.entries(this.indicators))if(t.codes.length>=2){this.prefixCodes.add(t.codes[0]);const i=`${t.codes[0]}:${t.codes[1]}`;this.sequenceMap[i]=e}this._buildSequenceResolvers()}_buildSequenceResolvers(){this.sequenceResolvers=[];const e=new Map;for(const[t,i]of Object.entries(this.indicators)){if(i.codes.length===0)continue;const o=i.codes[0];e.has(o)||e.set(o,[]),e.get(o).push({name:t,indicator:i})}for(const[t,i]of e){const o=Math.max(...i.map(c=>c.indicator.codes.length)),s={minCells:Math.min(...i.map(c=>c.indicator.codes.length)),maxCells:o,prefixCodes:new Set([t]),resolve:(c,y)=>{for(const{name:p,indicator:h}of i){if(h.codes.length!==c.length)continue;if(h.codes.every((T,L)=>T===c[L]))return{name:p,text:h.display,type:h.type,action:h.action}}return null}};this.sequenceResolvers.push(s)}}getSequenceResolvers(){return this.sequenceResolvers}getMaxSequenceDepth(){return 3}codeToText(e,t={}){const i=t.state??{};if(i.numberMode&&this.numberMap[e])return this.numberMap[e];if(this.alphabet[e]){let o=this.alphabet[e];return(i.capitalMode===1||i.capitalMode===2)&&(o=o.toUpperCase()),o}return this.symbols[e]?this.symbols[e]:this.contextDependent[e]?this._resolveContextDependent(e,t):e===this.indicatorCodes.NUMBER_SIGN?"â ¼":e===this.indicatorCodes.CAPITAL_SIGN?"â  ":e===this.indicatorCodes.LETTER_SIGN?"â ":e===0?" ":"?"}getAlphabet(){return{...this.alphabet}}getNumberMap(){return{...this.numberMap}}getIndicators(){return{...this.indicators}}getPrefixCodes(){return this.prefixCodes}_resolveContextDependent(e,t){const i=this.contextDependent[e];if(!i)return"?";if(i.rule==="space_or_start_before"){const o=t.precedingText?t.precedingText.slice(-1):"";if(o===""||o===" "||o===`
`)return i.variants.opening_quote}return i.default}resolveSequence(e,t,i={}){const o=`${e}:${t}`,r=this.sequenceMap[o];if(!r)return null;const s=this.indicators[r];return{name:r,text:s.display,type:s.type,action:s.action}}createInitialState(){return{numberMode:!1,capitalMode:0,typeformMode:null,typeformScope:null,pendingIndicator:null}}updateState(e,t,i){const o={...e};return t===0?(o.numberMode=!1,o.capitalMode=0,o.typeformScope==="symbol"&&(o.typeformMode=null,o.typeformScope=null)):t===this.indicatorCodes.NUMBER_SIGN?o.numberMode=!0:t===this.indicatorCodes.CAPITAL_SIGN?o.capitalMode=1:t===this.indicatorCodes.CONTINUOUS_CAPS?o.capitalMode=2:t===this.indicatorCodes.LETTER_SIGN?o.numberMode=!1:this.alphabet[t]&&e.capitalMode===1?o.capitalMode=0:e.numberMode&&!this.numberMap[t]&&!",.".includes(i)&&(o.numberMode=!1),o}applyIndicator(e,t){const i=this.indicators[t];if(!i)return e;const o={...e};return["italic","bold","underline","script"].includes(i.type)&&(i.action==="end"?(o.typeformMode=null,o.typeformScope=null):(o.typeformMode=i.type,o.typeformScope=i.action)),i.type==="capital"&&(i.action==="word"||i.action==="passage"?o.capitalMode=2:i.action==="end"&&(o.capitalMode=0)),o}isLetterAtoJ(e){return e in this.numberMap}isLetter(e){return this.alphabet[e]!==void 0&&this.alphabet[e].length===1}recalculateNumberMode(e){for(let t=e.length-1;t>=0;t--){const i=e.charCodeAt(t)-this.BRAILLE_START;if(i===this.indicatorCodes.NUMBER_SIGN)return!0;if(i===0)return!1}return!1}requiresContext(){return!0}}/**
 * UEB GRADE 2 CONTRACTION DATA
 * ============================
 * Unified English Braille Grade 2 contracted braille data.
 * 
 * Contains:
 * - Whole-word contractions
 * - Part-word (letter-group) contractions
 * - Lower contractions
 * - Strong contractions
 * 
 * @author Hana
 * @license MIT
 */const S={47:{braille:[47],text:"and",type:"whole",position:"standalone"},63:{braille:[63],text:"for",type:"whole",position:"standalone"},55:{braille:[55],text:"of",type:"whole",position:"standalone"},46:{braille:[46],text:"the",type:"whole",position:"standalone"},62:{braille:[62],text:"with",type:"whole",position:"standalone"},19:{braille:[19],text:"have",type:"whole",position:"standalone"},6:{braille:[6],text:"be",type:"whole",position:"standalone"},9:{braille:[9],text:"can",type:"whole",position:"standalone"},11:{braille:[11],text:"from",type:"whole",position:"standalone"},29:{braille:[29],text:"not",type:"whole",position:"standalone"},54:{braille:[54],text:"were",type:"whole",position:"standalone"},58:{braille:[58],text:"will",type:"whole",position:"standalone"},61:{braille:[61],text:"you",type:"whole",position:"standalone"},34:{braille:[34],text:"enough",type:"whole",position:"standalone"},38:{braille:[38],text:"his",type:"whole",position:"standalone"},20:{braille:[20],text:"in",type:"whole",position:"standalone"},52:{braille:[52],text:"was",type:"whole",position:"standalone"},33:{braille:[33],text:"child",type:"whole",position:"standalone"},41:{braille:[41],text:"shall",type:"whole",position:"standalone"},49:{braille:[49],text:"which",type:"whole",position:"standalone"},51:{braille:[51],text:"out",type:"whole",position:"standalone"},12:{braille:[12],text:"still",type:"whole",position:"standalone"}},M={6:{braille:[6],text:"be",type:"lower",position:"start"},18:{braille:[18],text:"con",type:"lower",position:"start"},50:{braille:[50],text:"dis",type:"lower",position:"start"},34:{braille:[34],text:"en",type:"lower",position:"start"},20:{braille:[20],text:"in",type:"lower",position:"start"}},w={ch:{braille:[33],text:"ch",type:"part",position:"middle"},gh:{braille:[35],text:"gh",type:"part",position:"middle"},sh:{braille:[41],text:"sh",type:"part",position:"middle"},th:{braille:[57],text:"th",type:"part",position:"middle"},wh:{braille:[49],text:"wh",type:"part",position:"middle"},ed:{braille:[43],text:"ed",type:"part",position:"middle"},er:{braille:[59],text:"er",type:"part",position:"middle"},ou:{braille:[51],text:"ou",type:"part",position:"middle"},ow:{braille:[42],text:"ow",type:"part",position:"middle"},st:{braille:[12],text:"st",type:"part",position:"middle"},ing:{braille:[44],text:"ing",type:"part",position:"end"}},le={day:{braille:[16,25],text:"day",type:"initial",position:"start",grade1Indicator:!0},know:{braille:[16,5],text:"know",type:"initial",position:"start",grade1Indicator:!0},name:{braille:[16,29],text:"name",type:"initial",position:"start",grade1Indicator:!0},part:{braille:[16,15],text:"part",type:"initial",position:"start",grade1Indicator:!0},time:{braille:[16,30],text:"time",type:"initial",position:"start",grade1Indicator:!0},father:{braille:[16,11],text:"father",type:"initial",position:"start",grade1Indicator:!0},mother:{braille:[16,13],text:"mother",type:"initial",position:"start",grade1Indicator:!0},lord:{braille:[16,7],text:"lord",type:"initial",position:"start",grade1Indicator:!0},one:{braille:[16,21],text:"one",type:"initial",position:"start",grade1Indicator:!0},under:{braille:[16,37],text:"under",type:"initial",position:"start",grade1Indicator:!0}},de={"-ance":{braille:[40,17],text:"ance",type:"final",position:"end",grade1Indicator:!0},"-ence":{braille:[48,17],text:"ence",type:"final",position:"end",grade1Indicator:!0},"-ful":{braille:[48,7],text:"ful",type:"final",position:"end",grade1Indicator:!0},"-ness":{braille:[48,14],text:"ness",type:"final",position:"end",grade1Indicator:!0},"-ity":{braille:[48,61],text:"ity",type:"final",position:"end",grade1Indicator:!0},"-ment":{braille:[48,30],text:"ment",type:"final",position:"end",grade1Indicator:!0},"-tion":{braille:[48,29],text:"tion",type:"final",position:"end",grade1Indicator:!0},"-sion":{braille:[40,29],text:"sion",type:"final",position:"end",grade1Indicator:!0}},E=16;/**
 * UEB GRADE 2 MODE
 * ================
 * Unified English Braille Grade 2 (contracted) mode implementation.
 *
 * Features:
 * - Inherits full alphabet, numbers, indicators from Grade 1
 * - Whole-word contractions (and, for, of, the, with, etc.)
 * - Part-word contractions (ch, sh, th, ing, etc.)
 * - Lower contractions (be, con, dis, en, in)
 * - Initial-letter contractions (day, know, name, etc.)
 * - Final-letter contractions (-tion, -ness, -ment, etc.)
 * - Word boundary detection
 * - Context-aware contraction resolution
 *
 * @author Hana
 * @license MIT
 */class ce extends K{constructor(){super(),this.contractionResolvers=[],this.grade1Mode=!1,this._initContractionResolvers()}_initContractionResolvers(){this.contractionResolvers=[];const e={minCells:1,maxCells:1,prefixCodes:new Set(Object.keys(S).map(o=>parseInt(o,16))),resolve:(o,r)=>{if(o.length!==1||!r.atWordBoundary&&!r.standalone)return null;const s=S[o[0]];return s?{name:`whole-word:${s.text}`,text:s.text,type:"contraction",action:"word"}:null}};this.contractionResolvers.push(e);const t={minCells:1,maxCells:1,prefixCodes:new Set(Object.keys(M).map(o=>parseInt(o,16))),resolve:(o,r)=>{if(o.length!==1||!r.atWordStart)return null;const s=M[o[0]];return s?{name:`lower:${s.text}`,text:s.text,type:"contraction",action:"word"}:null}};this.contractionResolvers.push(t);const i={minCells:1,maxCells:1,prefixCodes:new Set([33,35,41,57,49,43,59,51,42,12,44]),resolve:(o,r)=>{if(o.length!==1||r.atWordBoundary)return null;const s=o[0].toString(16),c=w[s];return c?{name:`part:${c.text}`,text:c.text,type:"contraction",action:"middle"}:null}};this.contractionResolvers.push(i)}getSequenceResolvers(){return[...super.getSequenceResolvers(),...this.contractionResolvers]}requiresContext(){return!0}textToBraille(e){const t=[];let i=0;for(;i<e.length;){if(/\s/.test(e[i])){t.push(0),i++;continue}let o=!1;for(const[y,p]of Object.entries(S))if(e.substring(i).toLowerCase().startsWith(p.text)){const h=e.substring(i+p.text.length).charAt(0);if(!h||/\s/.test(h)){t.push(parseInt(y,16)),i+=p.text.length,o=!0;break}}if(o)continue;for(const[y,p]of Object.entries(le))if(e.substring(i).toLowerCase().startsWith(y)){t.push(E),t.push(...p.braille),i+=y.length,o=!0;break}if(o)continue;let r=i;for(;r<e.length&&!/\s/.test(e[r]);)r++;const s=e.substring(i,r).toLowerCase();for(const[y,p]of Object.entries(de))if(s.endsWith(y)){t.push(E),t.push(...p.braille),i+=s.length,o=!0;break}if(o)continue;for(const[y,p]of Object.entries(w))if(s.includes(y)){t.push(...p.braille);const h=s.indexOf(y),k=s.substring(0,h),T=s.substring(h+y.length);for(const L of(k+T).split("")){const N=this.textToCode(L);N!==void 0&&t.push(N)}i+=s.length,o=!0;break}if(o)continue;const c=this.textToCode(e[i].toLowerCase());c!==void 0&&t.push(c),i++}return t}codeToText(e,t={}){const i=t.state;if(i!=null&&i.contractionMode&&!this.grade1Mode){const o=this.resolveContraction([e],t);if(o)return o.text}return super.codeToText(e,t)}resolveContraction(e,t){if(e.length===1){const i=S[e[0]];if(i&&(t.atWordBoundary||t.standalone))return{text:i.text,contraction:i};if(t.atWordStart){const o=M[e[0]];if(o)return{text:o.text,contraction:o}}}if(e.length>=1){const i=e[0].toString(16),o=w[i];if(o&&!t.atWordBoundary)return{text:o.text,contraction:o}}return null}createInitialState(){return{...super.createInitialState(),contractionMode:!0,pendingContraction:null,wordBuffer:"",lastWordBoundary:0,atWordStart:!0,wasContraction:!1}}updateState(e,t,i){const o={...e};return t===0?(o.atWordStart=!0,o.pendingContraction=null,o.wasContraction=i.length>0&&(S[t]!==void 0||M[t]!==void 0)):o.atWordStart=!1,t===E&&(this.grade1Mode=!0,o.contractionMode=!1),super.updateState(e,t,i),o}isAtWordBoundary(e){return e.atWordBoundary??!1}detectWordBoundaries(e){const t=[0];for(let i=0;i<e.length;i++)/\s/.test(e[i])&&i>0&&!/\s/.test(e[i-1])&&t.push(i);return t}getWordAtPosition(e,t){let i=t;for(;i>0&&!/\s/.test(e[i-1]);)i--;let o=t;for(;o<e.length&&!/\s/.test(e[o]);)o++;return i===o?null:{word:e.substring(i,o),start:i,end:o}}buildContractionContext(e,t,i){const o=e.substring(0,t),r=o.slice(-1),s=r===""||/\s/.test(r);return{precedingText:o,state:i,atWordBoundary:s,atWordStart:i.atWordStart,standalone:o.length===0||/\s$/.test(o)}}isValidContractionPosition(e,t){switch(e.position){case"standalone":return t.standalone===!0;case"start":return t.atWordStart===!0;case"end":return t.atWordBoundary===!0;case"middle":return!t.atWordBoundary&&!t.atWordStart;default:return!0}}setGrade1Mode(e){this.grade1Mode=e}getInfo(){return{name:this.name,id:this.id,description:this.description,language:"en"}}}/**
 * MODE SIDEBAR COMPONENT
 * =======================
 * Sidebar UI for selecting braille modes organized by category.
 *
 * Features:
 * - Collapsible category sections
 * - Keyboard navigation
 * - Visual indication of current mode
 * - Responsive design
 *
 * @author Hana
 * @license MIT
 */class ue{constructor(e){const t=document.getElementById(e.containerId);if(!t)throw new Error(`Container not found: #${e.containerId}`);this.container=t,this.collapsed=e.collapsed??!1,this.onModeSelect=e.onModeSelect,this.render(),this.attachListeners()}render(){const e=d.getAllCategories(),t=d.getMode();if(e.length===0){this.renderUncategorized();return}this.container.innerHTML=`
      <div class="mode-sidebar ${this.collapsed?"collapsed":""}">
        <div class="sidebar-header">
          <h3>Braille Modes</h3>
          <button class="sidebar-toggle" aria-label="Toggle sidebar">
            <span class="toggle-icon">${this.collapsed?"Â»":"Â«"}</span>
          </button>
        </div>
        <div class="sidebar-content">
          ${e.map(i=>this.renderCategory(i,t==null?void 0:t.id)).join("")}
        </div>
        <div class="sidebar-footer">
          <span class="shortcut-hint">Ctrl+M to cycle</span>
        </div>
      </div>
    `}renderUncategorized(){const e=d.getAllModes(),t=d.getMode();this.container.innerHTML=`
      <div class="mode-sidebar ${this.collapsed?"collapsed":""}">
        <div class="sidebar-header">
          <h3>Braille Modes</h3>
          <button class="sidebar-toggle" aria-label="Toggle sidebar">
            <span class="toggle-icon">${this.collapsed?"Â»":"Â«"}</span>
          </button>
        </div>
        <div class="sidebar-content">
          <div class="mode-list">
            ${e.map(i=>this.renderModeItem(i.getInfo(),t==null?void 0:t.id)).join("")}
          </div>
        </div>
        <div class="sidebar-footer">
          <span class="shortcut-hint">Ctrl+M to cycle</span>
        </div>
      </div>
    `}renderCategory(e,t){const i=!this.collapsed;return`
      <div class="category-section" data-category="${e.id}">
        <div class="category-header" role="button" tabindex="0" aria-expanded="${i}">
          <span class="category-name">${e.name}</span>
          <span class="category-toggle">${i?"-":"+"}</span>
        </div>
        <div class="category-content" ${i?"":'style="display: none;"'}>
          <div class="mode-list">
            ${e.modes.map(o=>this.renderModeItem(o,t)).join("")}
          </div>
        </div>
      </div>
    `}renderModeItem(e,t){const i=e.id===t;return`
      <div class="mode-item ${i?"active":""}" 
           data-mode="${e.id}" 
           role="button" 
           tabindex="0"
           aria-pressed="${i}">
        <span class="mode-name">${e.name}</span>
        ${e.description?`<span class="mode-description">${e.description}</span>`:""}
      </div>
    `}attachListeners(){var e;(e=this.container.querySelector(".sidebar-toggle"))==null||e.addEventListener("click",()=>{this.toggle()}),this.container.querySelectorAll(".category-header").forEach(t=>{const i=t;i.addEventListener("click",o=>{this.toggleCategory(o.currentTarget.parentElement)}),i.addEventListener("keydown",(o=>{const r=o;(r.key==="Enter"||r.key===" ")&&(o.preventDefault(),this.toggleCategory(o.currentTarget.parentElement))}))}),this.container.querySelectorAll(".mode-item").forEach(t=>{const i=t;i.addEventListener("click",o=>{const r=o.currentTarget.dataset.mode;r&&this.selectMode(r)}),i.addEventListener("keydown",(o=>{const r=o;if(r.key==="Enter"||r.key===" "){o.preventDefault();const s=o.currentTarget.dataset.mode;s&&this.selectMode(s)}}))}),this.unsubscribe=d.addListener(t=>{t.type==="modeChange"&&this.updateActiveMode(t.currentMode.id)})}toggle(){this.collapsed=!this.collapsed;const e=this.container.querySelector(".mode-sidebar");e==null||e.classList.toggle("collapsed",this.collapsed);const t=this.container.querySelector(".toggle-icon");t&&(t.textContent=this.collapsed?"Â»":"Â«")}toggleCategory(e){const t=e.querySelector(".category-content"),i=e.querySelector(".category-toggle"),o=e.querySelector(".category-header");if(t){const r=t.style.display==="none";t.style.display=r?"":"none",i&&(i.textContent=r?"-":"+"),o==null||o.setAttribute("aria-expanded",String(r))}}selectMode(e){try{d.setMode(e);const t=d.getMode();t&&this.onModeSelect&&this.onModeSelect(t.getInfo())}catch(t){console.error("[ModeSidebar] Failed to select mode:",t)}}updateActiveMode(e){this.container.querySelectorAll(".mode-item").forEach(i=>{i.classList.remove("active"),i.setAttribute("aria-pressed","false")});const t=this.container.querySelector(`[data-mode="${e}"]`);t&&(t.classList.add("active"),t.setAttribute("aria-pressed","true"))}handleKeyboard(e){if(this.collapsed)return;const t=Array.from(this.container.querySelectorAll(".mode-item, .category-header")),i=document.activeElement,o=t.indexOf(i);switch(e.key){case"ArrowDown":e.preventDefault(),o<t.length-1&&t[o+1].focus();break;case"ArrowUp":e.preventDefault(),o>0&&t[o-1].focus();break;case"Home":e.preventDefault(),t.length>0&&t[0].focus();break;case"End":e.preventDefault(),t.length>0&&t[t.length-1].focus();break}}destroy(){var e;(e=this.unsubscribe)==null||e.call(this),this.container.innerHTML=""}refresh(){this.render(),this.attachListeners()}}/**
 * BRAILLE EDITOR - MAIN ENTRY POINT
 * ==================================
 * Refactored to use TypeScript and the modular mode system.
 *
 * @author Hana
 * @license MIT
 */function u(n){const e=document.getElementById(n);if(!e)throw new Error(`Missing DOM element: #${n}`);return e}const F={save(n){try{return localStorage.setItem(A.LAYOUT,n),!0}catch(e){return console.warn("Failed to save layout preference:",e),!1}},load(n){try{const e=localStorage.getItem(A.LAYOUT);if(e!=null&&e.trim())return e}catch(e){console.warn("Failed to load layout preference:",e)}return n},clear(){try{localStorage.removeItem(A.LAYOUT)}catch(n){console.warn("Failed to clear layout preference:",n)}}};let b=g,l=null;function D(n){const e={};return[...n.leftHand,...n.rightHand].forEach(({key:t,dot:i})=>{e[t.toLowerCase()]=i,e[t.toUpperCase()]=i}),e}let x=f[g]?D(f[g]):{};const a={braillePreview:u("braille-preview"),textPreview:u("text-preview"),dotsPreview:u("dots-preview"),brailleEditor:u("braille-editor"),textEditor:u("text-editor"),brailleCount:u("braille-count"),textCount:u("text-count"),alphabetGrid:u("alphabet-grid"),numberGrid:u("number-grid"),numberModeIndicator:u("number-mode-indicator"),capitalModeIndicator:u("capital-mode-indicator"),statusText:u("status-text"),layoutSelector:u("layout-selector"),layoutDescription:u("layout-description"),keyboardLayout:u("keyboard-layout"),toast:u("toast"),copyBrailleBtn:u("btn-copy-braille"),copyTextBtn:u("btn-copy-text"),typeformModeIndicator:u("typeform-mode-indicator"),modeSelector:u("mode-selector"),currentModeDisplay:u("current-mode-display")};function Y(n,e=2e3){a.toast.textContent=n,a.toast.classList.add("show"),setTimeout(()=>a.toast.classList.remove("show"),e)}function v(n){return String.fromCharCode(ee+n)}function R(n){const e=[];for(let t=1;t<=6;t++)n&1<<t-1&&e.push(t);return e}function pe(){d.registerCategory({id:"ueb",name:"Unified English Braille",description:"UEB modes for English text"});const n=new K;d.registerModeWithCategory(n,"ueb");const e=new ce;d.registerModeWithCategory(e,"ueb");const t=d.loadPreference(n.id);d.setMode(t),l=new re(d.getMode()),d.addListener(ye)}function he(){try{document.getElementById("mode-sidebar-container")&&new ue({containerId:"mode-sidebar-container",collapsed:!1,onModeSelect:e=>{console.log(`[Main] Mode selected: ${e.name}`)}})}catch(n){console.warn("Failed to initialize mode sidebar:",n)}}function ye(n){n.type==="modeChange"&&(l.setMode(d.getMode()),be(),V(),C(),m(),a.currentModeDisplay.textContent=n.currentMode.name,Y(`Mode: ${n.currentMode.name}`))}function fe(){d.cycleToNext()}function ge(){d.cycleToPrevious()}function me(){const n=d.getModeOptions(),e=d.getMode();a.modeSelector.innerHTML=n.map(t=>`
    <div class="mode-option">
      <input type="radio" id="mode-${t.id}" name="braille-mode" 
             value="${t.id}" ${t.id===(e==null?void 0:e.id)?"checked":""}>
      <label for="mode-${t.id}">${t.name}</label>
    </div>
  `).join(""),document.querySelectorAll('input[name="braille-mode"]').forEach(t=>{t.addEventListener("change",()=>{d.setMode(t.value)})})}function be(){const n=d.getMode(),e=document.getElementById(`mode-${n==null?void 0:n.id}`);e&&(e.checked=!0)}function P(n,e){return`<div class="key" data-key="${n.toLowerCase()}" data-dot="${e}" 
    role="button" 
    tabindex="0"
    aria-label="Dot ${e} - Key ${n.toUpperCase()}"
    aria-pressed="false">
    <span class="key-letter">${n.toUpperCase()}</span>
    <span class="key-dot">${e}</span>
  </div>`}function $(n,e,t,i,o){return`<div class="alpha-item" ${i}="${o}" role="listitem" aria-label="${e}, dots ${t}">
    <span class="alpha-braille" aria-hidden="true">${n}</span>
    <span class="alpha-text">${e}</span>
    <span class="alpha-dots">${t}</span>
  </div>`}function Ce(){a.layoutSelector.innerHTML=Object.entries(f).map(([n,e])=>`
    <div class="layout-option">
      <input type="radio" id="layout-${n}" name="layout" value="${n}" ${n===b?"checked":""} aria-describedby="layout-description">
      <label for="layout-${n}">${e.name}</label>
    </div>
  `).join(""),document.querySelectorAll('input[name="layout"]').forEach(n=>{n.addEventListener("change",()=>q(n.value))}),z()}function q(n){if(!f[n]){console.error(`Unknown layout: ${n}`);return}b=n;const e=f[n];x=D(e),z(),xe(),I(),ve(),F.save(n);const t=document.getElementById(`layout-${n}`);t&&(t.checked=!0)}function Se(){const n=Object.keys(f),e=n[(n.indexOf(b)+1)%n.length];q(e),Y(`Layout: ${f[e].name}`)}function z(){a.layoutDescription.textContent=f[b].description}function xe(){const n=f[b],e=n.leftHand.map(({key:i,dot:o})=>P(i,o)).join(""),t=n.rightHand.map(({key:i,dot:o})=>P(i,o)).join("");a.keyboardLayout.innerHTML=`
    <div class="hand">${e}</div>
    <div class="hand">${t}</div>
  `,Me()}function Me(){document.querySelectorAll(".key").forEach(n=>{n.addEventListener("mousedown",e=>{e.preventDefault(),l.addDot(parseInt(n.dataset.dot)),n.classList.add("active"),n.setAttribute("aria-pressed","true"),m()}),n.addEventListener("mouseup",()=>{n.classList.remove("active"),n.setAttribute("aria-pressed","false")}),n.addEventListener("mouseleave",()=>{n.classList.remove("active"),n.setAttribute("aria-pressed","false")}),n.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),l.addDot(parseInt(n.dataset.dot)),n.classList.add("active"),n.setAttribute("aria-pressed","true"),m())}),n.addEventListener("keyup",e=>{(e.key==="Enter"||e.key===" ")&&(n.classList.remove("active"),n.setAttribute("aria-pressed","false"))})})}function ve(){const n=f[b],e=document.querySelector(".instructions p:first-child");if(!e)return;const t=n.leftHand.map(o=>`<kbd>${o.key.toUpperCase()}</kbd>`).join(""),i=n.rightHand.map(o=>`<kbd>${o.key.toUpperCase()}</kbd>`).join("");e.innerHTML=`Hold ${t} + ${i} to form dots.`}function m(){const n=d.getMode();if(!l.hasActiveDots()){if(l.isPendingIndicator()){const c=l.getPendingIndicator();a.braillePreview.textContent=v(c),a.textPreview.textContent="pendingâ€¦",a.dotsPreview.textContent=R(c).join("-"),a.braillePreview.classList.add("has-input")}else a.braillePreview.textContent="â €",a.textPreview.textContent="-",a.dotsPreview.textContent="-";O();return}const e=l.getCurrentCode(),t=l.getCurrentBraille(),i=l.getContext();let o=n.codeToText(e,i);const r=l.getDotsArray().join("-");if(l.isPendingIndicator()){const c=n.resolveSequence(l.getPendingIndicator(),e,i);c&&(o=`${c.text} (${c.name.toLowerCase().replace(/_/g," ")})`)}l.getCapitalMode()>0&&n.isLetter(e)&&(o=o.toUpperCase()),a.braillePreview.textContent=t,a.textPreview.textContent=o,a.dotsPreview.textContent=r,a.braillePreview.classList.toggle("has-input",l.hasActiveDots()),l.isInNumberMode()&&n.isLetterAtoJ(e)?Te(e):Ie(e)}function C(){if(a.brailleEditor.innerHTML=l.brailleContent+'<span class="cursor"></span>',a.textEditor.innerHTML=l.textContent+'<span class="cursor"></span>',a.brailleCount.textContent=`${l.length} chars`,a.textCount.textContent=`${l.textLength} chars`,a.textEditor.scrollTop=a.brailleEditor.scrollTop,a.numberModeIndicator.classList.toggle("active",l.isInNumberMode()),l.isPendingIndicator())a.statusText.textContent="Pending: "+v(l.getPendingIndicator())+" â€¦";else{const n=l.getTypeformMode();n?a.statusText.textContent=n.mode.charAt(0).toUpperCase()+n.mode.slice(1)+" ("+n.scope+")":l.isInNumberMode()?a.statusText.textContent="Number Mode Active":a.statusText.textContent="Ready"}Q(),Le()}function J(n,e){const t=document.querySelector(`.key[data-key="${n.toLowerCase()}"]`);t&&(t.classList.toggle("active",e),t.setAttribute("aria-pressed",e?"true":"false"))}function V(){const n=d.getMode(),e=n.getAlphabet();a.alphabetGrid.innerHTML=Object.entries(e).map(([i,o])=>$(v(parseInt(i)),o,R(parseInt(i)).join(""),"data-code",i)).join("");const t=n.getNumberMap();a.numberGrid.innerHTML=Object.entries(t).map(([i,o])=>$(v(parseInt(i)),o,R(parseInt(i)).join(""),"data-number-code",i)).join("")}function Ie(n){O();const e=document.querySelector(`.alpha-item[data-code="${n}"]`);e&&e.classList.add("highlight")}function Te(n){O();const e=document.querySelector(`.alpha-item[data-number-code="${n}"]`);e&&e.classList.add("highlight")}function O(){document.querySelectorAll(".alpha-item.highlight").forEach(n=>n.classList.remove("highlight"))}function Q(){const n=a.capitalModeIndicator,e=l.getCapitalMode(),t=n.querySelector("span:last-child");e===1?(t&&(t.textContent="Capital (next)"),n.classList.remove("caps-lock"),n.style.display="flex"):e===2?(t&&(t.textContent="CAPS LOCK"),n.classList.add("caps-lock"),n.style.display="flex"):n.style.display="none"}function Le(){const n=a.typeformModeIndicator,e=l.getTypeformMode();if(e){const i={italic:"ð‘°",bold:"ð",underline:"UÌ²",script:"ð’®"}[e.mode]??"âœ¦",o=e.mode.charAt(0).toUpperCase()+e.mode.slice(1)+" ("+e.scope+")",r=n.querySelector("span:first-child"),s=n.querySelector("span:last-child");r&&(r.textContent=i),s&&(s.textContent=o),n.className="typeform-indicator typeform-"+e.mode,n.style.display="flex"}else n.style.display="none"}function X(){l.confirmChar(),C()}function _(){l.deleteLastChar(),C()}function Ae(){l.addNewline(),C()}function we(){l.clearAll(),I(),C()}function I(){l.resetDots(),document.querySelectorAll(".key").forEach(n=>n.classList.remove("active")),m()}async function Z(n){const e=n==="braille"?l.brailleContent:l.textContent,t=n==="braille"?a.copyBrailleBtn:a.copyTextBtn;try{await navigator.clipboard.writeText(e);const i=t.textContent;t.textContent="âœ“ Copied!",t.style.background="#4caf50",setTimeout(()=>{t.textContent=i,t.style.background=""},1500)}catch(i){console.error("Copy failed:",i)}}function Ee(n){const e=x[n];l.hasDot(e)||(l.addDot(e),J(n,!0),m())}const B={Space:()=>X(),Backspace:()=>l.hasActiveDots()?I():_(),Delete:()=>_(),Escape:()=>I(),Enter:()=>Ae()};document.addEventListener("keydown",n=>{const e=n.key.toLowerCase();if(e in x){n.preventDefault(),Ee(e);return}if(e==="l"&&n.ctrlKey){n.preventDefault(),Se();return}if(e==="m"&&(n.ctrlKey||n.altKey)&&!n.shiftKey){n.preventDefault(),fe();return}if(e==="m"&&(n.ctrlKey||n.altKey)&&n.shiftKey){n.preventDefault(),ge();return}if(n.key==="c"&&n.altKey||n.key==="CapsLock"){n.preventDefault(),l.cycleCapitalMode(),Q();return}const t=B[n.code]||B[n.key];t&&(n.preventDefault(),t())});document.addEventListener("keyup",n=>{const e=n.key.toLowerCase();e in x&&J(e,!1)});a.brailleEditor.addEventListener("scroll",()=>{a.textEditor.scrollTop=a.brailleEditor.scrollTop});a.textEditor.addEventListener("scroll",()=>{a.brailleEditor.scrollTop=a.textEditor.scrollTop});var U;(U=document.querySelector('[data-action="confirm"]'))==null||U.addEventListener("click",X);var W;(W=document.querySelector('[data-action="delete"]'))==null||W.addEventListener("click",_);var j;(j=document.querySelector('[data-action="copy-braille"]'))==null||j.addEventListener("click",()=>Z("braille"));var H;(H=document.querySelector('[data-action="copy-text"]'))==null||H.addEventListener("click",()=>Z("text"));var G;(G=document.querySelector('[data-action="clear"]'))==null||G.addEventListener("click",we);function Re(){try{pe()}catch(e){console.error("Failed to initialize mode system:",e);return}try{he()}catch(e){console.error("Failed to initialize mode sidebar:",e)}try{Ce()}catch(e){console.error("Failed to initialize layout selector:",e)}try{me()}catch(e){console.error("Failed to initialize mode selector:",e)}try{q(F.load(g))}catch(e){console.error("Failed to set layout from storage, using default:",e),f[g]&&(x=D(f[g]))}try{V()}catch(e){console.error("Failed to build alphabet reference:",e)}try{C()}catch(e){console.error("Failed to update editors:",e)}try{m()}catch(e){console.error("Failed to update preview:",e)}const n=d.getMode();n&&(a.currentModeDisplay.textContent=n.name),console.log("Braille editor initialized successfully")}Re();
